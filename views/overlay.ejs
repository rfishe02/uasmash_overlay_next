<html>

<head>
  <title>UA Smash Overlay</title>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

  <style>
    .v-enter-active, .v-leave-active {
      transition: opacity 0.5s ease;
    }

    .v-enter-from, .v-leave-to {
      opacity: 0;
    }

    .slide-fade-enter-active {
      transition: all 0.3s ease-out;
    }

    .slide-fade-leave-active {
      transition: all 0.8s cubic-bezier(1, 0.5, 0.8, 1);
    }

    .slide-fade-enter-from,
    .slide-fade-leave-to {
      transform: translateX(20px);
      opacity: 0;
    }

    body {
      overflow: hidden;
    }

    .uaheader {
      height: 40px;
      color:white;
      font-weight:bold;
    }

    .uasubheader {
      font-size: 16pt;
      background-color: rgba(0,0,0,0.7);
      text-align: center;
      padding-top: 7px;
      margin-top: -8px;
      border-bottom-right-radius: 2rem;
      border-bottom-left-radius: 2rem;
      max-width: 700px;
    }

    .uaname {
      font-size: 18pt;
      max-width: 375px;
    }

    .uascore {
      text-align: center;
      font-size: 18pt;
      background-color: rgba(0,0,0,0.90);
      max-width: 75px;
    }

    .ualogo {
      margin-top: -7px;
      padding-left: 3px;
      background-color: rgba(0,0,0,1);
      border-bottom-right-radius: 0.5rem;
      border-bottom-left-radius: 0.5rem;
      border-top-left-radius: 0.5rem;
      border-top-right-radius: 0.5rem;
      max-width: 230px;
    }

    .rounded-pill-left {
      border-top-left-radius: 1.5rem;
      border-bottom-left-radius: 1.5rem;
    }

    .rounded-pill-right {
      border-top-right-radius: 1.5rem;
      border-bottom-right-radius: 1.5rem;
    }
  </style>

  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/vue@3"></script>

  <script src="/socket.io/socket.io.js"></script>

</head>

<body>
  <div id="app">

    <div class="container-fluid" style="height: 1080px">
      <div class="row justify-content-center" style="margin-top: 50px">
        <!-- CA2000 -->

        <div
          id="p1"
          class="uaheader uaname col text-truncate shadow rounded-pill-left"
          style="background-color: rgba(202, 34, 0, 0.9)"
        >
          {{ p1Name }}
        </div>
        <div id="p1score" class="uaheader uascore col shadow">
          {{ p1score }}
        </div>

        <div class="ualogo col shadow">
          <img
            id="logo"
            src="/fsmsmashlogo.png"
            style="height: 55px"
          />
        </div>

        <div id="p2score" class="uaheader uascore col shadow">
          {{ p2score }}
        </div>
        <!-- 237dd2 -->
        <div
          id="p2"
          class="uaheader uaname col text-truncate shadow rounded-pill-right"
          style="text-align: right; background-color: rgba(35, 125, 210, 0.9)"
        >
          {{ p2Name }}
        </div>
      </div>

      <transition>
        <div
          v-if="eventheader.length > 2"
          id="header-row"
          class="row justify-content-center"
        >
          <div
            id="event-header"
            class="col text-truncate uaheader uasubheader shadow"
          >
            {{ eventheader }}
          </div>
          <!--style="position: fixed;"-->
        </div>
      </transition>

    </div>

  </div>
</body>

<script>
  const { createApp} = Vue

  const socket = io("http://" + window.location.hostname + ":3000", {
    reconnectionDelayMax: 10000,
    autoConnect: false,
  })

  socket.on("overlay-push", ({ content, from }) => {
    overlayApp.p1 = content["teamOne"]
    overlayApp.p2 = content["teamTwo"]

    overlayApp.p1Name = overlayApp.p1 == null ? "" : overlayApp.p1.name
    overlayApp.p1score = overlayApp.p1 == null ? "" : overlayApp.p1.score

    overlayApp.p2Name = overlayApp.p2 == null ? "" : overlayApp.p2.name
    overlayApp.p2score = overlayApp.p2 == null ? "" : overlayApp.p2.score

    overlayApp.eventheader = content["eventheader"]
  })

  const overlayApp = createApp({
    data() {
      return {
        host: window.location.hostname,
        port: ":3000",
        p1: {},
        p2: {},
        p1Name: "",
        p2Name: "",
        p1score: "",
        p2score: "",
        eventheader: "",
        socket: socket
      }
    },
    mounted() {
      const urlParams = new URLSearchParams(window.location.search)
      const room = urlParams.get('id')

      if(room != null) {
        this.socket.auth = { room }
        this.socket.connect()
      }

    },
  }).mount('#app')

</script>

</html>
